---
- name: Create symbolic links
  ansible.builtin.file:
    src: "{{ item.src }}"
    dest: "{{ item.dest }}"
    state: link
  become: yes
  loop:
    - { src: "{{ cgrates_dir }}/data", dest: "/usr/share/cgrates" }
    - { src: "{{ golang_gopath }}/bin/cgr-engine", dest: "/usr/bin/cgr-engine" }

- name: Run post install scripts
  ansible.builtin.shell:
    cmd: "{{ item.cmd }}"
    chdir: '{{ cgrates_dir }}/data/storage/{{ item.db }}'
  become: yes
  loop:
    - { db: "mysql", cmd: "sh setup_ers_db.sh root CGRateS.org localhost" }
    - { db: "mysql", cmd: "sh setup_cgr_db.sh root CGRateS.org localhost" }
    - { db: "postgres", cmd: "sh create_db_with_users.sh" }
    - { db: "postgres", cmd: "sh create_ers_db.sh" }
    - { db: "mongo", cmd: "sh setup_cgr_db.sh" }

- name: Set versions
  ansible.builtin.shell:
    cmd: 'cgr-migrator -exec=*set_versions -config_path=/usr/share/cgrates/conf/samples/tutmysql'
  environment:
    PATH: "{{ lookup('env','PATH') }}:{{ golang_gopath }}/bin:/usr/local/go/bin:{{ ansible_env.PATH }}"
